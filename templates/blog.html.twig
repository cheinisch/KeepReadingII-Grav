{% extends 'partials/base.html.twig' %}

{% set collection = page.collection() %}

{% block content %}

{# --- 1) Param-Separator und aktuelle URL --- #}
{% set sep  = config.system.param_sep %}      {# meist ":" #}
{% set path = uri.path %}

{# --- 2) Tag/Kategorie aus Param oder Query holen --- #}
{% set active_tag      = uri.param('tag') ?: uri.query('tag') %}
{% set active_category = uri.param('category') ?: uri.query('category') %}

{# --- 3) Fallback: aus dem Pfad herauslösen, falls param() leer ist --- #}
{% if not active_tag and (('/tag' ~ sep) in path) %}
  {% set tmp = path|split('/tag' ~ sep) %}
  {% set active_tag = (tmp|length > 1) ? tmp[1]|split('/')[0] : null %}
{% endif %}
{% if not active_category and (('/category' ~ sep) in path) %}
  {% set tmp = path|split('/category' ~ sep) %}
  {% set active_category = (tmp|length > 1) ? tmp[1]|split('/')[0] : null %}
{% endif %}

{# --- 4) (optional) Normalisierung für spätere Filter (lowercase, "-" -> " ") --- #}
{% set tag_norm = active_tag ? active_tag|lower|replace({'-':' '}) : null %}
{% set cat_norm = active_category ? active_category|lower|replace({'-':' '}) : null %}


      		<section id="bloglist" class="mx-auto max-w-3xl px-1 md:px-0 py-10">
        		<header class="mb-6">
          			<h1 class="text-3xl font-semibold text-zinc-900 dark:text-zinc-100">{{ page.title|e('html') }}</h1>
					{% if active_tag %}
					<p class="text-lg text-zinc-500 dark:text-zinc-400">Filter: {{ active_tag }} <a href="{{ page.url }}" class="hover:text-red-600">&#x2715;</a></p>
					{% endif %}
					{% if active_category %}
					<p class="text-lg text-zinc-500 dark:text-zinc-400">Filter: {{ active_category }} <a href="{{ page.url }}" class="hover:text-red-600">&#x2715;</a></p>
					{% endif %}
					{% if not active_tag and not active_category %}
          			<p class="text-sm text-zinc-500 dark:text-zinc-400">Neueste Beiträge</p>
					{% endif %}
        		</header>
        		<div id="content">
				{% if not active_tag and not active_category %}
            		{{ page.content|raw }}	
				{% endif %}
        		</div>			
                <ul class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for child in collection %}
                        {% include 'partials/blog-list-item.html.twig' with {blog: page, page: child} %}
                    {% endfor %}
                </ul>
				<!-- Pagination -->
				
				{# Pagination anzeigen (wenn aktiv) #}
				{% if config.plugins.pagination.enabled and collection.params.pagination %}
				{% include 'partials/pagination.html.twig' with {
					blog: page,
					pagination: p,
					active_tag: active_tag,
					active_category: active_category
				} %}
				{% endif %}
				
            </section>
{% endblock %}